import{r as o,j as e,b as ee,g as R,t as f,B as u,A as se,e as ae,I as P,h as te,i as re}from"./index-BKXw_VyK.js";import{L as k}from"./label-BXviQguc.js";import{A as V,b as D,a as B}from"./avatar-BZdplzq1.js";import{c as le}from"./index-D7UJh6tX.js";import{P as G}from"./index-YajLREcw.js";import{H as E,N as A}from"./index-oVrvYLc-.js";import{L as ne}from"./lock-UPzsb-6u.js";import{m as F}from"./proxy-BXaEAfrz.js";var U="Progress",$=100,[ie]=le(U),[oe,ce]=ie(U),H=o.forwardRef((s,r)=>{const{__scopeProgress:i,value:d=null,max:a,getValueLabel:h=de,...l}=s;(a||a===0)&&!z(a)&&console.error(me(`${a}`,"Progress"));const m=z(a)?a:$;d!==null&&!O(d,m)&&console.error(xe(`${d}`,"Progress"));const n=O(d,m)?d:null,N=v(n)?h(n,m):void 0;return e.jsx(oe,{scope:i,value:n,max:m,children:e.jsx(G.div,{"aria-valuemax":m,"aria-valuemin":0,"aria-valuenow":v(n)?n:void 0,"aria-valuetext":N,role:"progressbar","data-state":q(n,m),"data-value":n??void 0,"data-max":m,...l,ref:r})})});H.displayName=U;var W="ProgressIndicator",X=o.forwardRef((s,r)=>{const{__scopeProgress:i,...d}=s,a=ce(W,i);return e.jsx(G.div,{"data-state":q(a.value,a.max),"data-value":a.value??void 0,"data-max":a.max,...d,ref:r})});X.displayName=W;function de(s,r){return`${Math.round(s/r*100)}%`}function q(s,r){return s==null?"indeterminate":s===r?"complete":"loading"}function v(s){return typeof s=="number"}function z(s){return v(s)&&!isNaN(s)&&s>0}function O(s,r){return v(s)&&!isNaN(s)&&s<=r&&s>=0}function me(s,r){return`Invalid prop \`max\` of value \`${s}\` supplied to \`${r}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${$}\`.`}function xe(s,r){return`Invalid prop \`value\` of value \`${s}\` supplied to \`${r}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${$} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var ue=H,he=X;function pe({className:s,value:r,...i}){return e.jsx(ue,{"data-slot":"progress",className:ee("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",s),...i,children:e.jsx(he,{"data-slot":"progress-indicator",className:"bg-primary h-full w-full flex-1 transition-all",style:{transform:`translateX(-${100-(r||0)}%)`}})})}function Ce({onBack:s,onComplete:r,initialRecipient:i,autoVerify:d}){const[a,h]=o.useState(1),[l,m]=o.useState(typeof i=="string"?i:""),[n,N]=o.useState(""),[j,I]=o.useState(!1),[M,T]=o.useState(!1),[y,w]=o.useState(!1),[S,K]=o.useState(""),[c,g]=o.useState(null),[fe,_]=o.useState(!1),J=a/3*100;o.useEffect(()=>{typeof i=="string"&&i.length>0&&(m(i),d&&C())},[i,d]);const C=async()=>{if(!l)return null;T(!0),g(null),_(!1),w(!1);try{const t=await R.checkUser(l),x=t?.data||t?.user||t,Q=(x?.f_name||x?.first_name||"").trim(),Y=(x?.l_name||x?.last_name||"").trim(),Z=(x?.name||`${Q} ${Y}`.trim()||l).trim();let p=x?.image;p&&typeof p=="string"&&!p.startsWith("http")&&(p=`https://market.bery.in/storage/app/public/profile/${p}`);const L={name:Z,phone:x?.phone||x?.email||l,image:p};return g(L),f.success("User verified!"),L}catch(t){return console.error("User check failed",t),_(!0),w(!0),f.info("User not found on server. Please enter name manually."),null}finally{T(!1)}},b=async()=>{if(a===1){let t=c;if(y&&S?(t={name:S,phone:l,image:void 0},g(t)):!t&&!y&&(t=await C()),!t)return;try{E.notification({type:A.Success})}catch{}h(a+1)}else if(a===2){try{E.notification({type:A.Success})}catch{}h(a+1)}else{I(!0);try{await R.transferFund(parseFloat(n),l);try{E.notification({type:A.Success})}catch{}f.success("Transfer Successful!"),r()}catch(t){t.response?.status===404?f.error("Transfer Unavailable",{description:"The Funds Transfer feature is not deployed on this server."}):f.error("Transfer Failed",{description:t.response?.data?.errors?.[0]?.message||"Something went wrong"})}finally{I(!1)}}};return e.jsxs("div",{className:"h-screen overflow-y-auto bg-[#0a0a1a] pb-32",children:[e.jsx("div",{className:"bg-gradient-to-br from-[#0f172a] to-[#1e3a8a] text-white px-5 py-6",children:e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx(u,{variant:"ghost",size:"icon",onClick:s,className:"text-white hover:bg-white/20",children:e.jsx(se,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-xl",style:{fontFamily:"Montserrat, sans-serif"},children:"Send Money"})]})}),e.jsx("div",{className:"px-5 -mt-10 py-6 pb-8",children:e.jsx(F.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.3},children:e.jsxs(ae,{className:"p-5 bg-[#1a1a2e] border-slate-700/40",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(pe,{value:J,className:"h-2 bg-slate-700"}),e.jsxs("div",{className:"flex justify-between mt-2 text-xs text-slate-400",children:[e.jsx("span",{className:a>=1?"text-blue-400":"",children:"Recipient"}),e.jsx("span",{className:a>=2?"text-blue-400":"",children:"Amount"}),e.jsx("span",{className:a>=3?"text-blue-400":"",children:"Confirm"})]})]}),a===1&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-lg mb-4 text-white",children:"Recipient Details"}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(k,{className:"text-xs text-slate-300",children:"Email or Phone"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(P,{value:l,onChange:t=>{m(t.target.value),g(null),w(!1)},onKeyDown:t=>t.key==="Enter"&&b(),placeholder:"Enter email or phone number",className:"mt-2 bg-[#0a0a1a] border-slate-700/40 text-white placeholder:text-slate-400/60 flex-1"}),e.jsx(u,{onClick:C,disabled:M||!l,className:"mt-2 bg-blue-600 hover:bg-blue-700",size:"icon",children:M?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}):e.jsx(te,{className:"w-4 h-4"})})]}),y&&e.jsxs(F.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"mt-4",children:[e.jsx(k,{className:"text-xs text-yellow-500",children:"Recipient Name (Required)"}),e.jsx(P,{value:S,onChange:t=>K(t.target.value),placeholder:"Enter recipient's name",className:"mt-2 bg-[#0a0a1a] border-yellow-500/50 text-white placeholder:text-slate-400/60",autoFocus:!0}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"We couldn't find this user. Please enter their name to continue."})]}),c&&e.jsxs(F.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mt-4 p-3 bg-blue-900/20 border border-blue-500/30 rounded-xl flex items-center gap-3",children:[e.jsxs(V,{className:"w-10 h-10 border border-white/10",children:[e.jsx(D,{src:c?.image||void 0}),e.jsx(B,{className:"bg-blue-600 text-white",children:String(c?.name||"").substring(0,2).toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-white",children:String(c?.name||l)}),e.jsx("p",{className:"text-xs text-blue-200/70",children:String(c?.phone||l)})]}),e.jsx(re,{className:"w-5 h-5 text-green-400 ml-auto"})]}),e.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"Enter the registered email or phone number of the user you want to send money to."})]})}),e.jsx(u,{onClick:b,disabled:!l,className:"w-full mt-6 bg-gradient-to-r from-[#0f172a] to-[#1e3a8a] h-12",children:"Continue"})]}),a===2&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-lg mb-6 text-white",children:"Enter Amount"}),e.jsxs("div",{className:"mb-5",children:[e.jsx(k,{className:"text-xs text-slate-300",children:"Amount"}),e.jsxs("div",{className:"relative mt-2",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-2xl text-slate-400/80",children:"₿"}),e.jsx(P,{type:"number",value:n,onChange:t=>N(t.target.value),placeholder:"0.00",className:"pl-12 text-3xl h-20 border-2 border-slate-700/40 focus:border-blue-600 bg-[#0a0a1a] text-white placeholder:text-slate-400/60"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(u,{onClick:()=>h(1),variant:"outline",className:"flex-1 h-12 border-slate-700/40 text-slate-300 hover:bg-slate-700/30",children:"Back"}),e.jsx(u,{onClick:b,disabled:!n||parseFloat(n)<=0,className:"flex-1 bg-gradient-to-r from-[#0f172a] to-[#1e3a8a] h-12",children:"Continue"})]})]}),a===3&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-[#0f172a] to-[#1e3a8a] mx-auto mb-4 flex items-center justify-center shadow-lg shadow-blue-600/30",children:e.jsx(ne,{className:"w-8 h-8 text-white"})}),e.jsx("h2",{className:"text-lg mb-2 text-white",children:"Confirm Transaction"})]}),e.jsxs("div",{className:"space-y-3 mb-6",children:[c&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-[#0a0a1a] rounded-xl border border-slate-700/40",children:[e.jsxs(V,{className:"w-10 h-10 border border-white/10",children:[e.jsx(D,{src:c?.image||void 0}),e.jsx(B,{className:"bg-blue-600 text-white",children:String(c?.name||l).substring(0,2).toUpperCase()})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs text-slate-400/80",children:"Sending to"}),e.jsx("p",{className:"text-sm text-white font-medium",children:String(c?.name||l)}),e.jsx("p",{className:"text-xs text-slate-500",children:String(c?.phone||l)})]})]}),e.jsxs("div",{className:"p-4 bg-[#0a0a1a] rounded-xl border border-slate-700/40",children:[e.jsx("p",{className:"text-xs text-slate-400/80 mb-1",children:"Amount"}),e.jsxs("p",{className:"text-3xl text-white",children:["₿ ",n]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"p-4 bg-[#0a0a1a] rounded-xl border border-slate-700/40",children:[e.jsx("p",{className:"text-xs text-slate-400/80 mb-1",children:"Fee"}),e.jsx("p",{className:"text-sm text-white",children:"Free"})]}),e.jsxs("div",{className:"p-4 bg-[#0a0a1a] rounded-xl border border-slate-700/40",children:[e.jsx("p",{className:"text-xs text-slate-400/80 mb-1",children:"Total"}),e.jsxs("p",{className:"text-sm text-white",children:["₿ ",n]})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(u,{onClick:()=>h(2),variant:"outline",className:"flex-1 h-12 border-slate-700/40 text-slate-300 hover:bg-slate-700/30",disabled:j,children:"Back"}),e.jsx(u,{onClick:b,disabled:j,className:"flex-1 bg-gradient-to-r from-[#0f172a] to-[#1e3a8a] h-12",children:j?"Sending...":"Confirm & Send"})]})]})]})},a)})]})}export{Ce as SendMoneyFlow};
